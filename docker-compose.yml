version: '3'

networks:
    webgateway:
        driver: bridge
    web:
        external:
            name: seedbox_webgateway
volumes:
    config:
        driver: local-persist
        driver_opts:
            mountpoint: /data/config
    torrents:
        driver: local-persist
        driver_opts:
            mountpoint: /data/torrents

services:
    # frontend:
    #     image: fromenje/seedbox:frontend
    #     build: Dockerfiles/frontend
    #     restart: always
    #     networks:
    #         - main
    #     ports:
    #         - "80:80"
    #         - "443:443"
    #     volumes:
    #         - config:/config
    #     env_file:
    #         - config

    traefik:
        image: traefik
        container_name: traefik
        restart: always
        networks:
            - webgateway
        command: --acme.email=${ACME_MAIL} --docker.domain=${TRAEFIK_DOMAIN}
        ports:
            - "80:80"
            - "443:443"
            - "8080:8080"
        volumes:
            - /var/run/docker.sock:/var/run/docker.sock
            - ./traefik.toml:/traefik.toml
            - /opt/traefik/acme.json:/acme.json

    deluge:
        image: fromenje/seedbox:deluge
        build: Dockerfiles/deluge
        restart: always
        networks:
            - web
        volumes:
            - torrents:/torrents
            - config:/config
        labels:
            - 'traefik.backend=deluge'
            - 'traefik.port=8112'
            - 'traefik.frontend.rule=Host:deluge.${TRAEFIK_DOMAIN}'
            - 'traefik.frontend.auth.basic=${HTTP_USER}:${HTTP_PASSWORD}'
            - 'traefik.enable=true'

    h5ai:
        image: fromenje/seedbox:h5ai
        build: Dockerfiles/h5ai
        restart: always
        networks:
            - web
        volumes:
            - torrents:/torrents
            - config:/config
        labels:
            - 'traefik.backend=h5ai'
            - 'traefik.port=12333'
            - 'traefik.frontend.rule=Host:explore.${TRAEFIK_DOMAIN}'
            - 'traefik.frontend.auth.basic=${HTTP_USER}:${HTTP_PASSWORD}'
            - 'traefik.enable=true'

    # owncloud:
    #     image: owncloud:latest
    #     restart: always
    #     volumes:
    #         - torrents:/var/www/html/data/admin/files
    #     networks:
    #         - main
    #     ports:
    #         - "7474:80"

    plex:
        image: fromenje/seedbox:plex
        build: Dockerfiles/plex
        restart: always
        networks:
            - web
        ports:
            - "32400:32400"
        volumes:
            - config:/config
            - torrents:/torrents
        env_file:
            - config
        labels:
            - 'traefik.backend=plex'
            - 'traefik.port=32400'
            - 'traefik.frontend.rule=Host:plex.${TRAEFIK_DOMAIN}'
            - 'traefik.frontend.auth.basic=${HTTP_USER}:${HTTP_PASSWORD}'
            - 'traefik.enable=true'

    sonarr:
        image: fromenje/seedbox:sonarr
        build: Dockerfiles/sonarr
        restart: always
        networks:
            - web
        volumes:
            - config:/config
            - torrents:/torrents
        environment:
            - PGID=0
            - PUID=0
            - TZ=Europe/Paris
        labels:
            - 'traefik.sonarr.backend=sonarr'
            - 'traefik.sonarr.port=8989'
            - 'traefik.sonarr.frontend.rule=Host:sonarr.${TRAEFIK_DOMAIN}'
            - 'traefik.sonarr.frontend.auth.basic=${HTTP_USER}:${HTTP_PASSWORD}'
            - 'traefik.jackett.backend=sonarr'
            - 'traefik.jackett.port=9117'
            - 'traefik.jackett.frontend.rule=Host:jackett.${TRAEFIK_DOMAIN}'
            - 'traefik.jackett.frontend.auth.basic=${HTTP_USER}:${HTTP_PASSWORD}'
            - 'traefik.enable=true'

    radarr:
        image: fromenje/seedbox:radarr
        build: Dockerfiles/radarr
        restart: always
        networks:
            - web
        volumes:
            - config:/config
            - torrents:/torrents
        environment:
            - PGID=0
            - PUID=0
            - TZ=Europe/Paris
        labels:
            - 'traefik.backend=radarr'
            - 'traefik.port=7878'
            - 'traefik.frontend.rule=Host:radarr.${TRAEFIK_DOMAIN}'
            - 'traefik.frontend.auth.basic=${HTTP_USER}:${HTTP_PASSWORD}'
            - 'traefik.enable=true'

    # organizr:
    #     image: lsiocommunity/organizr
    #     restart: always
    #     networks:
    #         - main
    #     volumes:
    #         - config:/config
    #     environment:
    #         - PGID=33
    #         - PUID=33
    #         - TZ=Europe/Paris

    portainer:
        image: portainer/portainer
        volumes:
            - /var/run/docker.sock:/var/run/docker.sock
        networks:
            - web
        command: --admin-password ${PORTAINER_ADMIN_PASSWORD} --host=unix:///var/run/docker.sock
        labels:
            - 'traefik.backend=portainer'
            - 'traefik.port=9000'
            - 'traefik.frontend.rule=Host:portainer.${TRAEFIK_DOMAIN}'
            - 'traefik.enable=true'

